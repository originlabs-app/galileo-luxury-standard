---
phase: 04-identity-infrastructure
plan: 04-02
title: Trust and Claims Registries
wave: 1
depends_on: []
estimated_files: 3
---

# Plan 04-02: Trust and Claims Registries

## Summary

This plan delivers the Solidity interface specifications for the Trusted Issuers Registry and Claim Topics Registry, plus a comprehensive specification of Galileo's predefined claim topics for the luxury domain. These registries are consortium-level infrastructure shared across all brands: the Trusted Issuers Registry manages authorized claim issuers (KYC providers, authentication labs, regulatory bodies), while the Claim Topics Registry defines the vocabulary of verifiable claims. The interfaces extend ERC-3643 patterns with Galileo-specific features: issuer categorization with certification requirements, hierarchical namespaced claim topics (galileo:kyc:basic instead of numeric), and distinction between compliance claims (expire) and heritage claims (permanent).

## Requirements Covered

- **IDENT-03**: Interfaces Solidity pour Trusted Issuers Registry - Extended interface with issuer categories and certification tracking
- **IDENT-04**: Interfaces Solidity pour Claim Topics Registry - Extended interface with namespace support and metadata

## Artifacts

### Solidity Interfaces
- `specifications/contracts/identity/ITrustedIssuersRegistry.sol` - Extended ERC-3643 interface with issuer categories, certification tracking, and granular topic-level trust
- `specifications/contracts/identity/IClaimTopicsRegistry.sol` - Extended interface with hierarchical namespaces, topic metadata, and compliance/heritage distinction

### Claim Topics Specification
- `specifications/identity/claim-topics.md` - Comprehensive specification of Galileo predefined claim topics for the luxury domain, including KYC tiers, luxury-specific claims, and jurisdiction-aware topics

## Must-Haves

1. **ITrustedIssuersRegistry.sol** extends ERC-3643 ITrustedIssuersRegistry interface
2. **ITrustedIssuersRegistry.sol** defines four issuer categories: KYC_PROVIDER, BRAND_ISSUER, AUTH_LAB, REGULATORY_BODY
3. **ITrustedIssuersRegistry.sol** supports certification tracking (ISO 17025 for labs, ISO 27001 for data handlers)
4. **ITrustedIssuersRegistry.sol** enables granular revocation per claim topic (not whole issuer)
5. **IClaimTopicsRegistry.sol** extends ERC-3643 IClaimTopicsRegistry interface
6. **IClaimTopicsRegistry.sol** includes topic metadata: namespace string, description, defaultExpiry, isCompliance flag
7. **IClaimTopicsRegistry.sol** includes `getTopicIdByNamespace(string)` for namespace-to-bytes32 conversion
8. **claim-topics.md** defines the initial 12 predefined topics with keccak256 topic IDs
9. **claim-topics.md** includes jurisdiction-specific KYC topics (EU MiFID, US SEC, APAC)
10. **claim-topics.md** includes luxury-specific topics (retailer, service center, authenticator, auction house)

## Approach

### Task 1: ITrustedIssuersRegistry Extended Interface

Create the extended Trusted Issuers Registry interface:

**File:** `specifications/contracts/identity/ITrustedIssuersRegistry.sol`

**Standard ERC-3643 functions (inherited):**
- `addTrustedIssuer(IClaimIssuer _trustedIssuer, uint256[] calldata _claimTopics)`
- `removeTrustedIssuer(IClaimIssuer _trustedIssuer)`
- `updateIssuerClaimTopics(IClaimIssuer _trustedIssuer, uint256[] calldata _claimTopics)`
- `getTrustedIssuers() returns (IClaimIssuer[])`
- `getTrustedIssuerClaimTopics(IClaimIssuer _trustedIssuer) returns (uint256[])`
- `isTrustedIssuer(address _issuer) returns (bool)`
- `hasClaimTopic(address _issuer, uint256 _claimTopic) returns (bool)`

**Galileo Extensions:**

```solidity
// SPDX-License-Identifier: Apache-2.0
pragma solidity ^0.8.20;

import "@erc3643org/erc-3643/contracts/registry/interface/ITrustedIssuersRegistry.sol";

/// @title Galileo Trusted Issuers Registry Interface
/// @notice Extended ERC-3643 interface with issuer categorization and certification tracking
/// @dev Consortium-level registry shared across all brand Identity Registries
interface IGalileoTrustedIssuersRegistry is ITrustedIssuersRegistry {

    /// @notice Issuer categories for tiered approval governance
    /// @dev TSC approves KYC_PROVIDER and REGULATORY_BODY; working groups approve others
    enum IssuerCategory {
        KYC_PROVIDER,      // Onfido, Jumio, SumSub - require ISO 27001
        BRAND_ISSUER,      // Luxury houses issuing retailer/service authorizations
        AUTH_LAB,          // Entrupy, gemmology labs - require ISO 17025
        REGULATORY_BODY    // ESPR notified bodies, national authorities
    }

    /// @notice Certification requirements by category
    struct Certification {
        string standard;        // "ISO 17025", "ISO 27001", "BRAND_AUDIT"
        string reference;       // Certificate number or audit reference
        uint256 validUntil;     // Expiration timestamp (0 = permanent)
        string verificationURI; // URL to verification or audit report
    }

    /// @notice Emitted when issuer is added with category
    event TrustedIssuerAdded(
        address indexed issuer,
        IssuerCategory indexed category,
        uint256[] claimTopics
    );

    /// @notice Emitted when issuer category is updated
    event IssuerCategoryUpdated(
        address indexed issuer,
        IssuerCategory indexed oldCategory,
        IssuerCategory indexed newCategory
    );

    /// @notice Emitted when issuer certification is set/updated
    event IssuerCertificationUpdated(
        address indexed issuer,
        string standard,
        string reference,
        uint256 validUntil
    );

    /// @notice Emitted when issuer is revoked for specific topic only
    event IssuerTopicRevoked(
        address indexed issuer,
        uint256 indexed claimTopic,
        string reason
    );

    /// @notice Emitted when issuer is suspended (temporary, all topics)
    event IssuerSuspended(
        address indexed issuer,
        string reason,
        uint256 suspendedUntil
    );

    /// @notice Emitted when issuer suspension is lifted
    event IssuerReactivated(
        address indexed issuer
    );

    /// @notice Add trusted issuer with category and certification
    /// @param _issuer Claim issuer contract address
    /// @param _claimTopics Array of claim topics issuer is authorized for
    /// @param _category Issuer category
    /// @param _certification Initial certification details
    function addTrustedIssuerWithCategory(
        IClaimIssuer _issuer,
        uint256[] calldata _claimTopics,
        IssuerCategory _category,
        Certification calldata _certification
    ) external;

    /// @notice Get issuer category
    /// @param _issuer Issuer address
    /// @return Issuer category enum
    function getIssuerCategory(address _issuer) external view returns (IssuerCategory);

    /// @notice Get issuer certification details
    /// @param _issuer Issuer address
    /// @return Certification struct
    function getIssuerCertification(address _issuer) external view returns (Certification memory);

    /// @notice Update issuer certification
    /// @param _issuer Issuer address
    /// @param _certification New certification details
    function updateIssuerCertification(
        address _issuer,
        Certification calldata _certification
    ) external;

    /// @notice Get all issuers by category
    /// @param _category Category to filter by
    /// @return Array of issuer addresses in that category
    function getIssuersByCategory(IssuerCategory _category) external view returns (address[] memory);

    /// @notice Revoke issuer for specific topic only (granular revocation)
    /// @param _issuer Issuer address
    /// @param _claimTopic Topic to revoke
    /// @param _reason Reason for revocation (for audit)
    /// @dev Historical claims for other topics remain valid
    function revokeIssuerForTopic(
        address _issuer,
        uint256 _claimTopic,
        string calldata _reason
    ) external;

    /// @notice Temporarily suspend issuer for all topics
    /// @param _issuer Issuer address
    /// @param _reason Suspension reason
    /// @param _until Timestamp when suspension ends (0 = indefinite)
    function suspendIssuer(
        address _issuer,
        string calldata _reason,
        uint256 _until
    ) external;

    /// @notice Reactivate suspended issuer
    /// @param _issuer Issuer address
    function reactivateIssuer(address _issuer) external;

    /// @notice Check if issuer is currently suspended
    /// @param _issuer Issuer address
    /// @return True if suspended
    function isIssuerSuspended(address _issuer) external view returns (bool);

    /// @notice Check if issuer's certification is valid (not expired)
    /// @param _issuer Issuer address
    /// @return True if certification is valid
    function isCertificationValid(address _issuer) external view returns (bool);
}
```

### Task 2: IClaimTopicsRegistry Extended Interface

Create the extended Claim Topics Registry interface with namespace support:

**File:** `specifications/contracts/identity/IClaimTopicsRegistry.sol`

**Standard ERC-3643 functions (inherited):**
- `addClaimTopic(uint256 _claimTopic)`
- `removeClaimTopic(uint256 _claimTopic)`
- `getClaimTopics() returns (uint256[])`

**Galileo Extensions:**

```solidity
// SPDX-License-Identifier: Apache-2.0
pragma solidity ^0.8.20;

import "@erc3643org/erc-3643/contracts/registry/interface/IClaimTopicsRegistry.sol";

/// @title Galileo Claim Topics Registry Interface
/// @notice Extended ERC-3643 interface with hierarchical namespaces and topic metadata
/// @dev Consortium-level registry defining the vocabulary of verifiable claims
interface IGalileoClaimTopicsRegistry is IClaimTopicsRegistry {

    /// @notice Topic metadata structure
    /// @dev Stored off-chain with on-chain hash for integrity; this interface returns cached values
    struct TopicMetadata {
        string namespace;       // e.g., "galileo:kyc:basic"
        string description;     // Human-readable description
        uint64 defaultExpiry;   // Default validity in seconds (0 = permanent/heritage claim)
        bool isCompliance;      // True = KYC/AML (expires), False = heritage (permanent until revoked)
    }

    /// @notice Emitted when topic is registered with metadata
    event ClaimTopicRegistered(
        uint256 indexed claimTopic,
        string namespace,
        string description,
        uint64 defaultExpiry,
        bool isCompliance
    );

    /// @notice Emitted when topic metadata is updated
    event TopicMetadataUpdated(
        uint256 indexed claimTopic,
        string description,
        uint64 defaultExpiry
    );

    /// @notice Emitted when topic is deprecated (soft removal)
    event ClaimTopicDeprecated(
        uint256 indexed claimTopic,
        string reason,
        uint256 deprecatedAt
    );

    /// @notice Register claim topic with full metadata
    /// @param _claimTopic Topic ID (keccak256 of namespace string)
    /// @param _metadata Topic metadata struct
    /// @dev Topic ID must match keccak256(_metadata.namespace) for consistency
    function addClaimTopicWithMetadata(
        uint256 _claimTopic,
        TopicMetadata calldata _metadata
    ) external;

    /// @notice Get topic metadata
    /// @param _claimTopic Topic ID
    /// @return TopicMetadata struct
    function getTopicMetadata(uint256 _claimTopic) external view returns (TopicMetadata memory);

    /// @notice Compute topic ID from namespace string
    /// @param _namespace Namespace string (e.g., "galileo:kyc:basic")
    /// @return Topic ID (keccak256 hash)
    /// @dev Pure function for deterministic computation
    function getTopicIdByNamespace(string calldata _namespace) external pure returns (uint256);

    /// @notice Check if topic is compliance-type (has expiration)
    /// @param _claimTopic Topic ID
    /// @return True if compliance claim (expires), false if heritage claim (permanent)
    function isComplianceTopic(uint256 _claimTopic) external view returns (bool);

    /// @notice Get all registered topics by compliance type
    /// @param _isCompliance True for compliance topics, false for heritage topics
    /// @return Array of topic IDs
    function getTopicsByType(bool _isCompliance) external view returns (uint256[] memory);

    /// @notice Deprecate a topic (soft removal, historical claims remain valid)
    /// @param _claimTopic Topic ID
    /// @param _reason Deprecation reason
    /// @dev Deprecated topics cannot be used for new claims but verify for historical
    function deprecateTopic(uint256 _claimTopic, string calldata _reason) external;

    /// @notice Check if topic is deprecated
    /// @param _claimTopic Topic ID
    /// @return True if deprecated
    function isTopicDeprecated(uint256 _claimTopic) external view returns (bool);

    /// @notice Get all topics in a namespace prefix
    /// @param _prefix Namespace prefix (e.g., "galileo:kyc:")
    /// @return Array of topic IDs matching prefix
    /// @dev Off-chain indexing recommended; on-chain is O(n) scan
    function getTopicsByPrefix(string calldata _prefix) external view returns (uint256[] memory);
}

/// @title Galileo Claim Topics Library
/// @notice Predefined claim topic constants
/// @dev Topic IDs are keccak256 hashes of namespace strings
library GalileoClaimTopics {
    // === KYC/Compliance Topics (expire annually by default) ===

    uint256 constant KYC_BASIC = uint256(keccak256("galileo:kyc:basic"));
    uint256 constant KYC_ENHANCED = uint256(keccak256("galileo:kyc:enhanced"));
    uint256 constant KYB_VERIFIED = uint256(keccak256("galileo:kyb:verified"));

    // Jurisdiction-specific KYC
    uint256 constant KYC_EU_MIFID = uint256(keccak256("galileo:kyc:eu:mifid"));
    uint256 constant KYC_US_SEC = uint256(keccak256("galileo:kyc:us:sec"));
    uint256 constant KYC_APAC_SG = uint256(keccak256("galileo:kyc:apac:sg"));

    // === Luxury-Specific Topics (brand-issued, typically annual renewal) ===

    uint256 constant AUTHORIZED_RETAILER = uint256(keccak256("galileo:luxury:retailer"));
    uint256 constant SERVICE_CENTER = uint256(keccak256("galileo:luxury:service"));
    uint256 constant AUTHENTICATOR = uint256(keccak256("galileo:luxury:authenticator"));
    uint256 constant AUCTION_HOUSE = uint256(keccak256("galileo:luxury:auction"));

    // === Heritage Topics (permanent until revoked) ===

    uint256 constant ORIGIN_CERTIFIED = uint256(keccak256("galileo:heritage:origin"));
    uint256 constant AUTHENTICITY_VERIFIED = uint256(keccak256("galileo:heritage:authentic"));

    /// @notice Compute topic ID from namespace
    function toTopicId(string memory namespace) internal pure returns (uint256) {
        return uint256(keccak256(bytes(namespace)));
    }
}
```

### Task 3: Claim Topics Specification Document

Create comprehensive documentation of all Galileo claim topics:

**File:** `specifications/identity/claim-topics.md`

**Structure:**
1. **Overview** - Namespace format, topic ID computation, compliance vs heritage
2. **KYC/Compliance Topics** - Table with namespace, topicId, description, defaultExpiry, requiredFields
3. **Jurisdiction-Specific KYC** - EU/US/APAC variants with regulatory references
4. **Luxury-Specific Topics** - Retailer, service center, authenticator, auction house
5. **Heritage Topics** - Origin, authenticity (permanent claims)
6. **Topic Lifecycle** - Registration, deprecation, historical validity
7. **Extension Process** - RFC process for new topics (per GOV-02), including ESPR/regulatory topics as future additions

**Content highlights:**

| Namespace | Topic ID | Description | Default Expiry | Is Compliance |
|-----------|----------|-------------|----------------|---------------|
| galileo:kyc:basic | 0x{hash} | Basic KYC verification | 365 days | Yes |
| galileo:kyc:enhanced | 0x{hash} | Enhanced due diligence | 365 days | Yes |
| galileo:kyb:verified | 0x{hash} | Business verification | 365 days | Yes |
| galileo:kyc:eu:mifid | 0x{hash} | EU MiFID KYC compliance | 365 days | Yes |
| galileo:kyc:us:sec | 0x{hash} | US SEC KYC compliance | 365 days | Yes |
| galileo:kyc:apac:sg | 0x{hash} | APAC (SG) KYC compliance | 365 days | Yes |
| galileo:luxury:retailer | 0x{hash} | Authorized retailer | 365 days | Yes |
| galileo:luxury:service | 0x{hash} | Certified service center | 365 days | Yes |
| galileo:luxury:authenticator | 0x{hash} | Accredited authenticator | 365 days | Yes |
| galileo:luxury:auction | 0x{hash} | Licensed auction house | 365 days | Yes |
| galileo:heritage:origin | 0x{hash} | Certified origin | None | No |
| galileo:heritage:authentic | 0x{hash} | Authenticity verified | None | No |

**Required fields per topic type:**
- KYC Basic: name, birthDate, nationality, verificationDate
- KYC Enhanced: + source of funds, PEP screening, adverse media
- KYB Verified: legalName, registrationNumber, jurisdiction, beneficialOwners
- Authorized Retailer: brandAuthorization, retailerLicense, territory, validFrom
- Service Center: brandAuthorization, serviceCertification, capabilities[], territory
- Authenticator: accreditationBody, methodologies[], specializations[]
- Auction House: auctionLicense, jurisdiction, bondAmount

## Dependencies

### External Standards
- **ERC-3643 v4.1.3**: Base interfaces for ITrustedIssuersRegistry, IClaimTopicsRegistry
- **ISO 17025**: Laboratory accreditation standard (AUTH_LAB certification)
- **ISO 27001**: Information security standard (KYC_PROVIDER certification)
- **MiFID II / TFR**: EU regulatory framework for KYC topics
- **SEC / FinCEN**: US regulatory framework for KYC topics

### Prior Phase Outputs
- **Phase 1 (01-02-PLAN)**: TSC governance for top-tier issuer approval
- **Phase 1 (01-03-PLAN)**: RFC process for new claim topic proposals
- **Phase 1 (01-02-PLAN)**: Graduated sanctions for issuer misconduct

### Phase 4 Context
- **04-CONTEXT.md**: Four issuer categories (KYC_PROVIDER, BRAND_ISSUER, AUTH_LAB, REGULATORY_BODY)
- **04-CONTEXT.md**: Tiered approval governance (TSC + working groups)
- **04-CONTEXT.md**: Granular revocation per claim topic
- **04-CONTEXT.md**: Hierarchical namespaced topic IDs
- **04-CONTEXT.md**: Optional expiration model (compliance vs heritage)

## Out of Scope

- Identity Registry interfaces (covered in 04-01-PLAN)
- Identity Registry Storage (covered in 04-01-PLAN)
- ONCHAINID specification (covered in 04-03-PLAN)
- W3C Verifiable Credentials (covered in 04-03-PLAN)
- Implementation code (interfaces and specification only)
- Governance smart contracts (multi-sig patterns)
- Topic ID off-chain registry hosting
- Issuer onboarding operational process
