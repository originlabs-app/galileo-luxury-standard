---
phase: 06-gs1-resolver
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - specifications/resolver/digital-link-uri.md
  - specifications/resolver/linkset-schema.json
autonomous: true
user_setup: []

must_haves:
  truths:
    - "GS1 Digital Link URI structure follows 1.6.0 standard with 14-digit GTIN normalization"
    - "All supported Application Identifiers (01, 21, 10, 17, 8006, 8010, 253) are formally specified"
    - "Linkset response format conforms to IETF RFC 9264 with GS1 vocabulary extensions"
    - "URI compression format enables short QR codes per GS1 Digital Link 1.6.0"
  artifacts:
    - path: "specifications/resolver/digital-link-uri.md"
      provides: "Complete GS1 Digital Link URI specification for Galileo resolver"
      contains: "14-digit GTIN"
    - path: "specifications/resolver/linkset-schema.json"
      provides: "JSON Schema for RFC 9264 linkset responses"
      contains: "linkset"
  key_links:
    - from: "specifications/resolver/digital-link-uri.md"
      to: "specifications/identity/DID-METHOD.md"
      via: "URI to DID mapping reference"
      pattern: "did:galileo"
    - from: "specifications/resolver/linkset-schema.json"
      to: "specifications/schemas/alignment/gs1-integration.md"
      via: "Link type vocabulary alignment"
      pattern: "gs1:pip"
---

<objective>
Create the formal GS1 Digital Link URI specification and linkset schema for the Galileo resolver.

Purpose: Define the URI structure that bridges physical product identifiers (QR codes, NFC tags) to digital identities, enabling ESPR-mandated Digital Product Passport access. This is the foundation for all resolver operations.

Output:
- specifications/resolver/digital-link-uri.md - Complete URI syntax specification
- specifications/resolver/linkset-schema.json - JSON Schema for linkset responses
</objective>

<execution_context>
@/Users/pierrebeunardeau/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pierrebeunardeau/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-gs1-resolver/06-RESEARCH.md
@specifications/identity/DID-METHOD.md
@specifications/schemas/alignment/gs1-integration.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: GS1 Digital Link URI Specification</name>
  <files>specifications/resolver/digital-link-uri.md</files>
  <action>
Create comprehensive GS1 Digital Link URI specification document with:

1. **URI Syntax (GS1 Digital Link 1.6.0)**
   - Base URI: `https://id.galileo.luxury/{ai}/{value}[/{ai2}/{value2}]...`
   - Primary pattern: `https://id.galileo.luxury/01/{GTIN14}/21/{Serial}`
   - Query parameters: `?linkType={type}&context={role}&lang={locale}`

2. **Application Identifier Reference Table**
   - AI 01 (GTIN-14): 14 digits, leading-zero normalized, check digit validation
   - AI 21 (Serial): 1-20 alphanumeric characters
   - AI 10 (Batch/Lot): 1-20 alphanumeric characters
   - AI 17 (Expiry): YYMMDD format
   - AI 8006 (ITIP): 18 digits for individual trade item pieces
   - AI 8010 (CPID): Component/part identifier
   - AI 253 (GDTI): Global Document Type Identifier

3. **GTIN Normalization Rules**
   - Always store and compare as 14 digits
   - GTIN-8/12/13 normalization: pad with leading zeros
   - Check digit validation using GS1 Modulo-10 algorithm
   - Example normalization table (GTIN-8 -> GTIN-14, GTIN-13 -> GTIN-14)

4. **URI Compression (Digital Link 1.6.0)**
   - Binary compression format for short QR codes
   - Compression indicator: `CBV` (Compressed Binary Value)
   - Decompression algorithm reference
   - When to use: QR codes on small items, NFC with limited storage

5. **URI to DID Mapping**
   - Mapping rule: `https://id.galileo.luxury/01/{GTIN}/21/{Serial}` -> `did:galileo:01:{GTIN}:21:{Serial}`
   - Reference to DID-METHOD.md for complete DID specification
   - Bidirectional mapping for GS1 -> Galileo and Galileo -> GS1

6. **Validation Rules**
   - GTIN check digit validation algorithm (Modulo-10 weight-3)
   - Serial number character set: `[A-Za-z0-9\-\.]{1,20}`
   - URI syntax validation regex
   - Error responses for invalid URIs (400 Bad Request with error details)

7. **Examples Section**
   - Valid URI examples for each AI combination
   - Invalid URI examples with error explanations
   - Compressed vs uncompressed examples

Format: Follow existing specification style from DID-METHOD.md (version header, table of contents, ABNF grammar, examples).

Reference: GS1 Digital Link Standard 1.6.0 (April 2025) as cited in 06-RESEARCH.md.
  </action>
  <verify>
Verify the document:
- Contains ABNF grammar for URI syntax
- Includes GTIN normalization rules with examples
- Lists all supported Application Identifiers with formats
- References DID-METHOD.md for URI-to-DID mapping
- Includes check digit validation algorithm
  </verify>
  <done>
Specification document exists at specifications/resolver/digital-link-uri.md with complete URI syntax, GTIN normalization, AI reference table, compression format, and validation rules per GS1 Digital Link 1.6.0 standard.
  </done>
</task>

<task type="auto">
  <name>Task 2: Linkset JSON Schema</name>
  <files>specifications/resolver/linkset-schema.json</files>
  <action>
Create JSON Schema for GS1 Linkset response format per IETF RFC 9264:

1. **Root Schema**
   - $schema: "https://json-schema.org/draft/2020-12/schema"
   - $id: "https://spec.galileo.luxury/resolver/linkset/v1.0.0/schema.json"
   - type: object with @context and linkset properties

2. **@context Definition**
   - Required vocabularies: IANA relation types, GS1 vocabulary, Galileo vocabulary
   - Prefix mappings: gs1 -> https://gs1.org/voc/, galileo -> https://vocab.galileo.luxury/

3. **Linkset Array Schema**
   - anchor: URI of the product (required)
   - itemDescription: Human-readable product name (optional)
   - Link relation types as properties (gs1:pip, gs1:sustainabilityInfo, etc.)

4. **Link Object Schema**
   - href: Target URL (required, format: uri)
   - title: Link title (optional)
   - hreflang: Array of language codes (optional)
   - type: MIME type (optional)
   - context: Array of access contexts (optional, Galileo extension)

5. **GS1 Standard Link Types**
   - gs1:defaultLink (always present)
   - gs1:pip (Product Information Page)
   - gs1:sustainabilityInfo
   - gs1:instructions
   - gs1:regulatoryInfo
   - gs1:traceability
   - gs1:certificationInfo
   - gs1:hasRetailers

6. **Galileo Custom Link Types**
   - galileo:authenticity
   - galileo:internalDPP
   - galileo:auditTrail
   - galileo:serviceInfo
   - galileo:technicalSpec
   - galileo:complianceDPP
   - galileo:espr

7. **Validation Constraints**
   - anchor must be valid GS1 Digital Link URI
   - At least gs1:defaultLink must be present
   - href values must be valid URIs
   - hreflang must be BCP 47 language tags

Include inline descriptions for each property explaining its purpose and usage.
  </action>
  <verify>
Validate JSON Schema:
```bash
# Check JSON syntax
cat specifications/resolver/linkset-schema.json | python3 -m json.tool > /dev/null && echo "Valid JSON"

# Verify required properties exist
grep -q '"linkset"' specifications/resolver/linkset-schema.json && echo "Has linkset property"
grep -q 'gs1:pip' specifications/resolver/linkset-schema.json && echo "Has GS1 link types"
grep -q 'galileo:authenticity' specifications/resolver/linkset-schema.json && echo "Has Galileo link types"
```
  </verify>
  <done>
JSON Schema exists at specifications/resolver/linkset-schema.json with complete linkset structure, GS1 standard link types, Galileo custom link types, and validation constraints per RFC 9264.
  </done>
</task>

</tasks>

<verification>
Phase 6 Plan 01 verification:

1. **URI Specification Completeness**
   - [ ] GTIN-14 normalization documented with algorithm
   - [ ] All supported AIs (01, 21, 10, 17, 8006, 8010, 253) specified
   - [ ] URI compression format documented
   - [ ] Check digit validation algorithm included
   - [ ] URI-to-DID mapping references DID-METHOD.md

2. **Linkset Schema Validity**
   - [ ] Valid JSON Schema (draft 2020-12)
   - [ ] Includes GS1 vocabulary link types
   - [ ] Includes Galileo custom link types
   - [ ] anchor property validates as GS1 Digital Link URI
   - [ ] Requires gs1:defaultLink

3. **Standards Compliance**
   - [ ] GS1 Digital Link 1.6.0 alignment
   - [ ] IETF RFC 9264 linkset format
   - [ ] References existing gs1-integration.md for consistency
</verification>

<success_criteria>
- GS1 Digital Link URI specification complete with 14-digit GTIN normalization
- Linkset JSON Schema validates against RFC 9264 format
- Both documents reference each other and align with existing specifications
- All Application Identifiers supported by Galileo are formally documented
</success_criteria>

<output>
After completion, create `.planning/phases/06-gs1-resolver/06-01-SUMMARY.md`
</output>
